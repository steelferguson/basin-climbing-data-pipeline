# Session Summary

**Date:** 2026-02-04 10:00-11:00 CT
**Project:** Basin Climbing Data Pipeline
**Git:** main branch (not yet committed)

## Ideas
- Fresh AB test after fixing the delayed `-sent` tag issue

## Tasks Completed
- Created new AB test experiment `day_pass_conversion_2026_02`
- Marked previous experiment `day_pass_conversion_2026_01` as ended
- Updated all flag rules to reference new experiment ID

## Summary

### New Experiment Created

Created a fresh AB test starting today (2026-02-04) to properly track day pass → membership conversions now that the `-sent` tag delay fix is in place.

### Changes Made

**1. `data/experiments/ab_test_experiments.csv`**
- Marked `day_pass_conversion_2026_01` as `ended` with end date 2026-02-03
- Added new experiment `day_pass_conversion_2026_02`:

| Field | Value |
|-------|-------|
| experiment_id | day_pass_conversion_2026_02 |
| experiment_name | Day Pass to Membership Conversion Test (Feb 2026) |
| start_date | 2026-02-04 |
| end_date | (active) |
| group_a_definition | email/phone hash last digit 0-4: Direct 2-week membership offer |
| group_b_definition | email/phone hash last digit 5-9: Two-step flow (half-price 2nd visit → 2-week offer after return) |
| entry_criteria | Day pass checkin within 3 days; no checkins in prior 60 days; not active member; not flagged in last 180 days; not synced in last 30 days |
| status | active |

**2. `data_pipeline/customer_flags_config.py`**
- Updated `experiment_id` references from `day_pass_conversion_2026_01` to `day_pass_conversion_2026_02` in:
  - `FirstTimeDayPass2WeekOfferFlag` (Group A) - line 327
  - `SecondVisitOfferEligibleFlag` (Group B Step 1) - line 461
  - `SecondVisit2WeekOfferFlag` (Group B Step 2) - line 575

### How the Test Works

**Group Assignment:**
- Uses email/phone hash (not customer_id) for household consistency
- Hash last digit 0-4 → Group A
- Hash last digit 5-9 → Group B

**Group A Flow (Direct Offer):**
1. Customer checks in with day pass (first time or after 60+ day break)
2. Gets tagged `first_time_day_pass_2wk_offer`
3. Receives direct 2-week membership offer email

**Group B Flow (Two-Step):**
1. Customer checks in with day pass (first time or after 60+ day break)
2. Gets tagged `second_visit_offer_eligible`
3. Receives half-price second visit offer email
4. When they return and check in again:
   - Gets tagged `second_visit_2wk_offer`
   - Receives 2-week membership offer email

### Tracking

- New experiment entries are logged to `data/experiments/customer_experiment_entries.csv` with `experiment_id: day_pass_conversion_2026_02`
- Each entry records: customer_id, experiment_id, entry_date, group, customer_id_last_digit, entry_flag

### Next Steps

1. Run the flag sync to start adding new customers to the experiment
2. Monitor SendGrid webhooks for emails being delivered
3. Track conversions via `conversion_snapshots.csv` and `day_pass_visits_enriched.csv`

### Key Files Modified
- `data/experiments/ab_test_experiments.csv` - Added new experiment, ended old one
- `data_pipeline/customer_flags_config.py` - Updated experiment_id references

### How to Continue
1. Commit these changes to git
2. Run sync: `python -m data_pipeline.sync_flags_to_shopify`
3. Monitor experiment entries being logged
4. After a few days, analyze conversion rates by group
